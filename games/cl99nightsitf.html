<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bubbls/99itf@main/style.css"/>

<style>
    canvas:focus { outline: none; }
    html, body {
        padding: 0;
        margin: 0;
        overflow: hidden;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
        height: 100%;
    }
</style>

<title>Velora â€“ 99Days</title>
</head>

<body class="dark">

<div id="unity-container" class="unity-desktop">
    <canvas id="unity-canvas" tabindex="-1"></canvas>
</div>

<div id="loading-cover">
    <div id="unity-progress-bar-empty" style="display:none;">
        <div id="unity-progress-bar-full"></div>
    </div>
    <div class="spinner"></div> 
</div>

<script>
    const buildUrl = "https://cdn.jsdelivr.net/gh/bubbls/99itf@main/Build";
    const loaderUrl = buildUrl + "/Build.loader.js";
    const cdnBaseUrl = "https://cdn.jsdelivr.net/gh/bubbls/99itf@main/";

    const dataParts = [
        cdnBaseUrl + "Build.data.br.part0",
        cdnBaseUrl + "Build.data.br.part1",
        cdnBaseUrl + "Build.data.br.part2",
        cdnBaseUrl + "Build.data.br.part3",
    ];

    const wasmParts = [
        cdnBaseUrl + "Build.wasm.br.part0",
        cdnBaseUrl + "Build.wasm.br.part1",
        cdnBaseUrl + "Build.wasm.br.part2",
        cdnBaseUrl + "Build.wasm.br.part3",
        cdnBaseUrl + "Build.wasm.br.part4",
    ];

    async function fetchAndCombineParts(partUrls) {
        const buffers = [];
        for (const url of partUrls) {
            const res = await fetch(url);
            if (!res.ok) throw new Error("Failed loading: " + url);
            const buf = await res.arrayBuffer();
            buffers.push(buf);
        }
        const total = buffers.reduce((a,b)=>a+b.byteLength,0);
        const combined = new Uint8Array(total);
        let offset = 0;
        for (const b of buffers) {
            combined.set(new Uint8Array(b), offset);
            offset += b.byteLength;
        }
        return new Blob([combined], { type:"application/octet-stream" });
    }

    const config = {
        dataUrl: "",
        frameworkUrl: buildUrl + "/Build.framework.js",
        codeUrl: "",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "99Days",
        productVersion: "0.1"
    };

    const canvas = document.querySelector("#unity-canvas");
    const loadingCover = document.querySelector("#loading-cover");
    const progressBarEmpty = document.querySelector("#unity-progress-bar-empty");
    const progressBarFull = document.querySelector("#unity-progress-bar-full");
    const spinner = document.querySelector(".spinner");

    document.addEventListener("contextmenu", e => e.preventDefault());

    // Load Unity
    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = async () => {
        const dataBlob = await fetchAndCombineParts(dataParts);
        const wasmBlob = await fetchAndCombineParts(wasmParts);
        config.dataUrl = URL.createObjectURL(dataBlob);
        config.codeUrl = URL.createObjectURL(wasmBlob);

        createUnityInstance(canvas, config, (progress) => {
            spinner.style.display = "none";
            progressBarEmpty.style.display = "block";
            progressBarFull.style.width = `${progress * 100}%`;
        }).then(instance => {
            loadingCover.style.display = "none";
        }).catch(err => console.error("Unity load error:", err));
    }
    document.body.appendChild(script);
</script>

<!-- ADS (unchanged from your version, fully working) -->
<style>
  #ad-container {
    position: fixed;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: min(728px, calc(100% - 20px));
    height: 90px;
    background: rgba(0, 0, 0, 0.90);
    display: none;
    z-index: 99999;
    overflow: hidden;
    transition: transform 0.5s ease-in-out;
  }
  #ad-container.hidden { transform: translate(-50%, -100%); }
  #close-ad { position:absolute; top:6px; right:8px; background:#ff4d4d; color:white; padding:5px 9px; border-radius:4px; }
</style>

<div id="ad-container" aria-hidden="true">
    <iframe id="ad-iframe" src="" width="728" height="90" frameborder="0"></iframe>
    <button id="close-ad">Close</button>
</div>

<script>
(function(){
    const ad = document.getElementById("ad-container");
    const close = document.getElementById("close-ad");

    function showAd() {
        ad.style.display = "block";
        ad.classList.remove("hidden");
    }

    setTimeout(showAd, 2000);

    close.addEventListener("click", () => {
        ad.classList.add("hidden");
    });
})();
</script>

</body>
</html>
